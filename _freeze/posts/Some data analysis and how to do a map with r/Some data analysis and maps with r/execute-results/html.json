{
  "hash": "3437e8e00518794b4c3ab21e6287e85e",
  "result": {
    "markdown": "---\ntitle: \"Some R studio drill and how to do maps\"\nformat: html \neditor: visual\nimage: map.png\nexecute: \n  freeze: true\n---\n\n\nWhat follows is a short demonstration on how to do chloropleth map in R studio. What follows was part a bonus task of a practical of one of my master's courses on applied methods with R. I tried to do some maps and the result was good despite the fact that It can take a long time to figure out how to do. This post is thus for anyone who wants to see how maps can be done on R studio without wasting too much time.\n\n\n\n\n\n## Description of some variables of the dataset\n\n| Variable name     | Short description                                          | Information                                                                                                                                         |\n|------------------------|------------------------|------------------------|\n| ccode             | Country code                                               | Country code with the ISO-3166-1 standard                                                                                                           |\n| cname             | Country name                                               | Country name                                                                                                                                        |\n| year              | Year                                                       |                                                                                                                                                     |\n| ht_region         | Region of the Country                                      | Tenfold politico-geographic classification of world region from 1 to 10                                                                             |\n| wdi_area          | Land area (sq.km)                                          | Country's total area excluding area under inland water bodies, exclusive economic zones and claims to continental shelf                             |\n| wdi_pop           | Total population                                           | All residents regardless of legal status or citizenship (midyear estimates)                                                                         |\n| wdi_popden        | Population density                                         | People per sq. km of land area. Midyear population divided by land area in square kilometers                                                        |\n| br_dem            | Is the country a democracy                                 | Dummy variable indicator of democracy based on minimalist definition (if there is free and fair election, peaceful turnover of officers)            |\n| br_elect          | Typology of political institutions                         | Alternative democracy indicator capturing degree of multi-party competition.                                                                        |\n| chga_hinst        | Regime Institutions                                        | Six-fold classification of political regimes                                                                                                        |\n| ht_regtype        | Regime Type                                                | Qualitative variable representing the political regime of each country based on 26 levels                                                           |\n| p_polity2         | Revised Combined Polity Score                              | Ordinal variable: range from -10 (strongly autocratic) to +10 (strongly democratic)                                                                 |\n| wdi_gnicon2010    | GNI (constant 2010 US dollar)                              | Gross national income: sum of value added by all resident producers plus any product taxes less subsidies                                           |\n| wdi_gnicapcon2010 | GNI per capital (constant 2010 US dollar)                  | GNI divided by midyear population                                                                                                                   |\n| wdi_gdpcapcon2010 | GDP per capita (constant 2010 US dollar)                   | Gross domestic product divided by midyear population. GDP is the sum of gross value added by residents producers plus product taxes minus subsidies |\n| wdi_lifexp        | Life expectancy at birth, total (years)                    | Number of years a newborn infant would live if prevailing patterns of mortality at the time of its birth were to stay the same throughout its life  |\n| wdi_litrad        | Literacy rate, adult total (% of people ages 15 and above) | Percentage of the population above 15 who can understand, read and write a short simple statement                                                   |\n| undp_hdi          | Human Development Index                                    | Summary measure of average achievement in health, knowledge and decent standards of living                                                          |\n| wdi_expmil        | Military expenditure (% of GDP)                            | All current and capital expenditures on the armed forces                                                                                            |\n| wdi_internet      | Individuals using the Internet (% of population)           | Internet users who have used Internet in the last 3 months                                                                                          |\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Chloropleth maps\n\nLet's try to do some maps to visualize some of the dataset variables\n\nI first load the packages required to do maps on r.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rgdal)\nlibrary(countrycode)\nlibrary(gganimate)\nlibrary(lubridate)\nlibrary(sf)\nlibrary(viridis)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(maps)\nlibrary(maptools)\nlibrary(rgeos)\nlibrary(biscale)\nlibrary(cowplot)\n\nmap <- readOGR(\"F:/myblog/posts/Some data analysis and how to do a map with r/world map\")#Note: the shapefile for the world map was downloaded in the naturalearth website: https://www.naturalearthdata.com/downloads/\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOGR data source with driver: ESRI Shapefile \nSource: \"F:\\myblog\\posts\\Some data analysis and how to do a map with r\\world map\", layer: \"ne_50m_admin_0_countries\"\nwith 242 features\nIt has 168 fields\nInteger64 fields read as strings:  NE_ID \n```\n:::\n:::\n\n\nTo plot maps, a shapefile is required. I downloaded mine from [Natural earth](https://www.naturalearthdata.com/downloads/).\n\nI then have to \"fortify\" the map data to make it tidyverse compatible\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_fortify <- fortify(map, region = \"SOVEREIGNT\")\nunique(map_fortify$id)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] \"Afghanistan\"                      \"Albania\"                         \n  [3] \"Algeria\"                          \"Andorra\"                         \n  [5] \"Angola\"                           \"Antarctica\"                      \n  [7] \"Antigua and Barbuda\"              \"Argentina\"                       \n  [9] \"Armenia\"                          \"Australia\"                       \n [11] \"Austria\"                          \"Azerbaijan\"                      \n [13] \"Bahrain\"                          \"Bangladesh\"                      \n [15] \"Barbados\"                         \"Belarus\"                         \n [17] \"Belgium\"                          \"Belize\"                          \n [19] \"Benin\"                            \"Bhutan\"                          \n [21] \"Bolivia\"                          \"Bosnia and Herzegovina\"          \n [23] \"Botswana\"                         \"Brazil\"                          \n [25] \"Brunei\"                           \"Bulgaria\"                        \n [27] \"Burkina Faso\"                     \"Burundi\"                         \n [29] \"Cabo Verde\"                       \"Cambodia\"                        \n [31] \"Cameroon\"                         \"Canada\"                          \n [33] \"Central African Republic\"         \"Chad\"                            \n [35] \"Chile\"                            \"China\"                           \n [37] \"Colombia\"                         \"Comoros\"                         \n [39] \"Costa Rica\"                       \"Croatia\"                         \n [41] \"Cuba\"                             \"Cyprus\"                          \n [43] \"Czechia\"                          \"Democratic Republic of the Congo\"\n [45] \"Denmark\"                          \"Djibouti\"                        \n [47] \"Dominica\"                         \"Dominican Republic\"              \n [49] \"East Timor\"                       \"Ecuador\"                         \n [51] \"Egypt\"                            \"El Salvador\"                     \n [53] \"Equatorial Guinea\"                \"Eritrea\"                         \n [55] \"Estonia\"                          \"eSwatini\"                        \n [57] \"Ethiopia\"                         \"Federated States of Micronesia\"  \n [59] \"Fiji\"                             \"Finland\"                         \n [61] \"France\"                           \"Gabon\"                           \n [63] \"Gambia\"                           \"Georgia\"                         \n [65] \"Germany\"                          \"Ghana\"                           \n [67] \"Greece\"                           \"Grenada\"                         \n [69] \"Guatemala\"                        \"Guinea\"                          \n [71] \"Guinea-Bissau\"                    \"Guyana\"                          \n [73] \"Haiti\"                            \"Honduras\"                        \n [75] \"Hungary\"                          \"Iceland\"                         \n [77] \"India\"                            \"Indonesia\"                       \n [79] \"Iran\"                             \"Iraq\"                            \n [81] \"Ireland\"                          \"Israel\"                          \n [83] \"Italy\"                            \"Ivory Coast\"                     \n [85] \"Jamaica\"                          \"Japan\"                           \n [87] \"Jordan\"                           \"Kashmir\"                         \n [89] \"Kazakhstan\"                       \"Kenya\"                           \n [91] \"Kiribati\"                         \"Kosovo\"                          \n [93] \"Kuwait\"                           \"Kyrgyzstan\"                      \n [95] \"Laos\"                             \"Latvia\"                          \n [97] \"Lebanon\"                          \"Lesotho\"                         \n [99] \"Liberia\"                          \"Libya\"                           \n[101] \"Liechtenstein\"                    \"Lithuania\"                       \n[103] \"Luxembourg\"                       \"Madagascar\"                      \n[105] \"Malawi\"                           \"Malaysia\"                        \n[107] \"Maldives\"                         \"Mali\"                            \n[109] \"Malta\"                            \"Marshall Islands\"                \n[111] \"Mauritania\"                       \"Mauritius\"                       \n[113] \"Mexico\"                           \"Moldova\"                         \n[115] \"Monaco\"                           \"Mongolia\"                        \n[117] \"Montenegro\"                       \"Morocco\"                         \n[119] \"Mozambique\"                       \"Myanmar\"                         \n[121] \"Namibia\"                          \"Nauru\"                           \n[123] \"Nepal\"                            \"Netherlands\"                     \n[125] \"New Zealand\"                      \"Nicaragua\"                       \n[127] \"Niger\"                            \"Nigeria\"                         \n[129] \"North Korea\"                      \"North Macedonia\"                 \n[131] \"Northern Cyprus\"                  \"Norway\"                          \n[133] \"Oman\"                             \"Pakistan\"                        \n[135] \"Palau\"                            \"Panama\"                          \n[137] \"Papua New Guinea\"                 \"Paraguay\"                        \n[139] \"Peru\"                             \"Philippines\"                     \n[141] \"Poland\"                           \"Portugal\"                        \n[143] \"Qatar\"                            \"Republic of Serbia\"              \n[145] \"Republic of the Congo\"            \"Romania\"                         \n[147] \"Russia\"                           \"Rwanda\"                          \n[149] \"Saint Kitts and Nevis\"            \"Saint Lucia\"                     \n[151] \"Saint Vincent and the Grenadines\" \"Samoa\"                           \n[153] \"San Marino\"                       \"São Tomé and Principe\"           \n[155] \"Saudi Arabia\"                     \"Senegal\"                         \n[157] \"Seychelles\"                       \"Sierra Leone\"                    \n[159] \"Singapore\"                        \"Slovakia\"                        \n[161] \"Slovenia\"                         \"Solomon Islands\"                 \n[163] \"Somalia\"                          \"Somaliland\"                      \n[165] \"South Africa\"                     \"South Korea\"                     \n[167] \"South Sudan\"                      \"Spain\"                           \n[169] \"Sri Lanka\"                        \"Sudan\"                           \n[171] \"Suriname\"                         \"Sweden\"                          \n[173] \"Switzerland\"                      \"Syria\"                           \n[175] \"Taiwan\"                           \"Tajikistan\"                      \n[177] \"Thailand\"                         \"The Bahamas\"                     \n[179] \"Togo\"                             \"Tonga\"                           \n[181] \"Trinidad and Tobago\"              \"Tunisia\"                         \n[183] \"Turkey\"                           \"Turkmenistan\"                    \n[185] \"Tuvalu\"                           \"Uganda\"                          \n[187] \"Ukraine\"                          \"United Arab Emirates\"            \n[189] \"United Kingdom\"                   \"United Republic of Tanzania\"     \n[191] \"United States of America\"         \"Uruguay\"                         \n[193] \"Uzbekistan\"                       \"Vanuatu\"                         \n[195] \"Vatican\"                          \"Venezuela\"                       \n[197] \"Vietnam\"                          \"Western Sahara\"                  \n[199] \"Yemen\"                            \"Zambia\"                          \n[201] \"Zimbabwe\"                        \n```\n:::\n:::\n\n\nThe biggest problem to plot a map will be the names of all the countries in the two datasets because I have to successfully join the dataset to the map-dataset, I have to recode the name in one dataset. The package countrycode will do most of the work, but some countries still need to be recoded.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_qog$cname <- countryname(data_qog$cname, destination = \"cldr.short.en\")\ndata_qog$cname[data_qog$cname == \"US\"] <- \"United States of America\"\ndata_qog$cname[data_qog$cname == \"UK\"] <- \"United Kingdom\"\ndata_qog$cname[data_qog$cname == \"Congo - Kinshasa\"] <- \"Democratic Republic of the Congo\"\ndata_qog$cname[data_qog$cname == \"Côte d’Ivoire\"] <- \"Ivory Coast\"\ndata_qog$cname[data_qog$cname ==  \"Tanzania\"] <- \"United Republic of Tanzania\"\n```\n:::\n\n\nI join the datasets by the country names:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_join <- map_fortify %>%\n  left_join(data_qog, by = c(\"id\" = \"cname\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in left_join(., data_qog, by = c(id = \"cname\")): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 1 of `x` matches multiple rows in `y`.\nℹ Row 1 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n:::\n:::\n\n\nAre military expenditure geographically related to the probability of a country to be autocratic? I will explore with two maps the relation between p_polity and wdi_expmil. I expect countries with high military expenditure to be more autocratic.\n\nI then plot the first map with the variable p_polity2:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmap_join %>% \n  filter(year == 2015) %>% \n  ggplot()+\n  aes(x = long, y = lat, group = group, fill = factor(p_polity2), color = I(\"black\"))+\n  geom_polygon()+\n  theme_minimal()+\n  scale_fill_ordinal(\n          guide = guide_legend(\n            direction = \"horizontal\",\n            title.position = 'top',\n            title.hjust = 0.5,\n            label.hjust = 1,\n            nrow = 1,\n            byrow = TRUE,\n            reverse = TRUE,\n            label.position = \"bottom\"\n          ),\n          option = \"magma\",\n          name = \"p_polity2 index\"\n      )+\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank()\n        )+\n  labs(title = \"Revised combined polity score across countries (2015)\")+\n  ylab(\"\")+\n  xlab(\"\") -> map_plot\n\nmap_plot\n```\n\n::: {.cell-output-display}\n![](Some-data-analysis-and-maps-with-R_files/figure-html/BT 5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nThe more democratic countries in 2015 are concentrated in western Europe, America, East and East/South East Asia (Indonesia, Japan, South Korea), South Pacific and India and Mongolia. The autocratic countries tend to be in Africa, Middle East, some in east Europe and South Asia.\n\nI now plot the second map military expenditure wdi_expmil:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmap_join %>% \n  filter(year == 2015) %>% \n  ggplot()+\n  aes(x = long, y = lat, group = group, fill = wdi_expmil, color = I(\"black\"))+\n  geom_polygon()+\n  theme_minimal()+\n  ylab(\"\")+\n  xlab(\"\")+\n  scale_fill_viridis(\n          option = \"magma\",\n          direction = -1,\n          name = \"Military expenditure (% of GDP)\"\n      )+\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_blank(),\n        axis.text.y = element_blank()\n        )+\n  labs(title = \"Military expenditure in 2015\",\n       caption = \"All current and capital expenditures on the armed forces\")\n```\n\n::: {.cell-output-display}\n![](Some-data-analysis-and-maps-with-R_files/figure-html/BT 6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nSeeing the latter map on military expenditure, I would conclude that there is no clear inverse correlation between degree of democracy and military expenditure: there are countries which are strongly democratic which have relatively high military expenditure such as the US. A lot of African countries are autocratic, but do not have a really high military expenditure except for Algeria and South Sudan. The only region for which there is a correlation between autocracy and military expenditure seems to be Middle East, with Saudi Arabia being the best illustration.\n",
    "supporting": [
      "Some-data-analysis-and-maps-with-R_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}