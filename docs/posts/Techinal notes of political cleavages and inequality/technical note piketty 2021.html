<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-17">

<title>Celâl Güney - From income brackets to income decile</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Celâl Güney</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../CV.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:celal.gueney@etu.unige.ch"> <i class="bi bi-envelope-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../../index.html">
 <span class="dropdown-text">Post</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jeylal.github.io/heterodox-economics/">
 <span class="dropdown-text">Economics</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">From income brackets to income decile</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Political Economy</div>
                <div class="quarto-category">Stats</div>
                <div class="quarto-category">Coding</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 17, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">July 18, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="how-far-can-we-go-with-income-brackets-in-progress" class="level2">
<h2 class="anchored" data-anchor-id="how-far-can-we-go-with-income-brackets-in-progress">How far can we go with income brackets? (in progress)</h2>
<p>To build their database on <a href="https://wpid.world/">World political cleavages and inequality</a>, Piketty and his team had to use electoral survey data. One problem with these sources is that they collect income data through brackets, without reporting the overall income average of the sample or the average per bracket. This Thus poses the question of how far one can go in terms of statistical analysis with only income brackets as a source of information for income. I will here explore what can be done with such a variable as well as the <a href="https://wid.world/document/building-the-world-political-cleavages-and-inequality-database-a-new-dataset-on-electoral-behaviors-in-50-democracies-1948-2020-world-inequality-lab-technical-note-2021-01/">technical note</a> that Piketty et al.&nbsp;(2021) provides to explain how they computed the vote share for income and education decile, which they claim is one of their main contributions on political cleavages and inequality.</p>
<section id="from-brackets-to-decile" class="level3">
<h3 class="anchored" data-anchor-id="from-brackets-to-decile">From brackets to decile</h3>
<p>The wpid is based on an impressive <a href="https://wpid.world/resources/en/zip/wpid-micro.zip">dataset</a> compiling electoral survey data of 500 elections since 1948. Since the technical note takes Canada’s 2015 election as an example, I will use the latter here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ca <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"ca.dta"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ca2015 <span class="ot">&lt;-</span> ca <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ca)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(ca2015<span class="sc">$</span>inc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8 10 11 12 13 14 15 16 17 18 19 20</code></pre>
</div>
</div>
<p>Note that there is already something going on here: in the dataset, the variable income has 19 brackets/categories here whereas it has 18 in the technical note. Furthermore, income brackets “jump” from 8 to 10. I will ignore these issues and still work with this dataset, we just won’t have the same results as in Piketty &amp; al’s example.</p>
<p>A first step in analyzing such a variable is to compute the frequency, relative frequency and the cumulative frequencies. More precisely, I will construct two tables. On the one hand, I compute the descriptive statistics for the NDP’s voters within each income brackets. On the other hand, I construct a table for the overall distribution of income brackets for the NPD’s voters only. Note that I directly add the proportion of NDP’s voters from the first table to the second one to simplify further calculations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ca2015 <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(inc) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(votendp) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum.n =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="ot">-&gt;</span> table.income.pervote</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>ca2015 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(votendp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(inc) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(votendp) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_vote =</span> table.income.pervote<span class="sc">$</span>prop[table.income.pervote<span class="sc">$</span>votendp <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum.n =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">rangeleft =</span> <span class="fu">lag</span>(<span class="fu">cumsum</span>(prop), <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumrelfreqN =</span> <span class="fu">cumsum</span>(prop),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumrelfreqInc =</span> <span class="fu">cumsum</span>(inc<span class="sc">/</span><span class="fu">sum</span>(inc))) <span class="ot">-&gt;</span> table.income</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>table.income.pervote <span class="sc">%&gt;%</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">caption =</span> <span class="st">"Distribution of the vote for the NDP by income group"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="eootzamcou" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#eootzamcou .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#eootzamcou .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eootzamcou .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#eootzamcou .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#eootzamcou .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#eootzamcou .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eootzamcou .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eootzamcou .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#eootzamcou .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#eootzamcou .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#eootzamcou .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#eootzamcou .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#eootzamcou .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#eootzamcou .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#eootzamcou .gt_from_md > :first-child {
  margin-top: 0;
}

#eootzamcou .gt_from_md > :last-child {
  margin-bottom: 0;
}

#eootzamcou .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#eootzamcou .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#eootzamcou .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#eootzamcou .gt_row_group_first td {
  border-top-width: 2px;
}

#eootzamcou .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eootzamcou .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#eootzamcou .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#eootzamcou .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eootzamcou .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eootzamcou .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#eootzamcou .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#eootzamcou .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#eootzamcou .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eootzamcou .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eootzamcou .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eootzamcou .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eootzamcou .gt_left {
  text-align: left;
}

#eootzamcou .gt_center {
  text-align: center;
}

#eootzamcou .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#eootzamcou .gt_font_normal {
  font-weight: normal;
}

#eootzamcou .gt_font_bold {
  font-weight: bold;
}

#eootzamcou .gt_font_italic {
  font-style: italic;
}

#eootzamcou .gt_super {
  font-size: 65%;
}

#eootzamcou .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#eootzamcou .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#eootzamcou .gt_indent_1 {
  text-indent: 5px;
}

#eootzamcou .gt_indent_2 {
  text-indent: 10px;
}

#eootzamcou .gt_indent_3 {
  text-indent: 15px;
}

#eootzamcou .gt_indent_4 {
  text-indent: 20px;
}

#eootzamcou .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Distribution of the vote for the NDP by income group</caption>
<thead class="gt_col_headings">
<tr class="header">
<th id="inc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">inc</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="cum.n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cum.n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6826347</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">167</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3173653</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">161</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">161</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7419355</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">217</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2580645</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">49</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">49</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7656250</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">64</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2343750</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">129</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">129</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7865854</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">164</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2134146</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">108</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">108</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6708075</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">161</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3291925</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">112</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">112</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7044025</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">47</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">159</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2955975</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7215190</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">44</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">158</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2784810</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">244</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">244</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7746032</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">71</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">315</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2253968</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">140</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">140</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8045977</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">34</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">174</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1954023</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7651007</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">149</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2348993</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">154</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">154</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7549020</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">50</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">204</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2450980</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">105</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">105</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7894737</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">28</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">133</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2105263</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">208</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">208</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7878788</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">264</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2121212</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">95</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">95</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8333333</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">114</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1666667</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">113</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">113</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8129496</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">26</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">139</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1870504</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">171</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">171</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8300971</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">206</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1699029</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">83</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">83</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7830189</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">23</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">106</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2169811</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">143</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">143</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8171429</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">32</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">175</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1828571</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">145</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">145</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8734940</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">21</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">166</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1265060</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">caption =</span>  <span class="st">"Distribution of income group among NDP's voters"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="lkhyqcowsj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lkhyqcowsj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#lkhyqcowsj .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lkhyqcowsj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lkhyqcowsj .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#lkhyqcowsj .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#lkhyqcowsj .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lkhyqcowsj .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lkhyqcowsj .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lkhyqcowsj .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lkhyqcowsj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lkhyqcowsj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lkhyqcowsj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lkhyqcowsj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lkhyqcowsj .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lkhyqcowsj .gt_from_md > :first-child {
  margin-top: 0;
}

#lkhyqcowsj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lkhyqcowsj .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lkhyqcowsj .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lkhyqcowsj .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lkhyqcowsj .gt_row_group_first td {
  border-top-width: 2px;
}

#lkhyqcowsj .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkhyqcowsj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lkhyqcowsj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lkhyqcowsj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lkhyqcowsj .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkhyqcowsj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lkhyqcowsj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lkhyqcowsj .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#lkhyqcowsj .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lkhyqcowsj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkhyqcowsj .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lkhyqcowsj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkhyqcowsj .gt_left {
  text-align: left;
}

#lkhyqcowsj .gt_center {
  text-align: center;
}

#lkhyqcowsj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lkhyqcowsj .gt_font_normal {
  font-weight: normal;
}

#lkhyqcowsj .gt_font_bold {
  font-weight: bold;
}

#lkhyqcowsj .gt_font_italic {
  font-style: italic;
}

#lkhyqcowsj .gt_super {
  font-size: 65%;
}

#lkhyqcowsj .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lkhyqcowsj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lkhyqcowsj .gt_indent_1 {
  text-indent: 5px;
}

#lkhyqcowsj .gt_indent_2 {
  text-indent: 10px;
}

#lkhyqcowsj .gt_indent_3 {
  text-indent: 15px;
}

#lkhyqcowsj .gt_indent_4 {
  text-indent: 20px;
}

#lkhyqcowsj .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Distribution of income group among NDP's voters</caption>
<thead class="gt_col_headings">
<tr class="header">
<th id="inc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">inc</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="prop_vote" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop_vote</th>
<th id="cum.n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cum.n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
<th id="rangeleft" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">rangeleft</th>
<th id="cumrelfreqN" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqN</th>
<th id="cumrelfreqInc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqInc</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3173653</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.004975124</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2580645</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">109</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.014925373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2343750</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">124</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02046385</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.029850746</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2134146</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">159</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.049751244</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3291925</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">212</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.074626866</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">47</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2955975</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">259</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06412005</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.104477612</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">44</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2784810</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">303</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06002729</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.139303483</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">71</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2253968</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">374</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09686221</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.179104478</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">34</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1954023</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">408</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04638472</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.228855721</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2348993</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">443</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.283582090</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">50</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2450980</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">493</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06821282</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.343283582</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">28</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2105263</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">521</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03819918</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.407960199</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2121212</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">577</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.477611940</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1666667</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">596</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02592087</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.552238806</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">26</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1870504</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">622</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03547067</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.631840796</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1699029</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">657</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.716417910</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">23</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2169811</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">680</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03137790</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.805970149</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">32</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1828571</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">712</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04365621</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.900497512</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">21</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1265060</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">733</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02864939</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">1.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">1.000000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can then plot income groups against their proportion</p>
<div class="cell fig-cap-location-top">
<div class="sourceCode cell-code" id="cb5" data-cap-location="top"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>table.income.pervote <span class="sc">%&gt;%</span> <span class="fu">filter</span>(votendp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(inc), <span class="at">y =</span> prop)<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Income group"</span>) <span class="ot">-&gt;</span> income.group.plot</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(inc), <span class="at">y =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="ot">-&gt;</span> income.group.plot2</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(income.group.plot, income.group.plot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="technical-note-piketty-2021_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Distribution of Income groups: Canadian 2015 election survey</figcaption>
</figure>
</div>
</div>
</div>
<p>On the left, we have a graph very similar to the one of the technical note. The right-sided graph is different, because the proportion are for the overall NPD’s voters whereas the left-sided graph represents the proportion within the income group. For example, 30% of income bracket 1 voted for the NDP, but they represent about 7.4% of total NDP’s voters.</p>
<p>What makes Piketty’s team approach special and interesting is their systematic analysis in terms of quantile groups. This is, according to them, their main contribution and this approach has the advantage to allow for systematic comparison accross space and time. We will try to reproduce here their conversion of income group into quantiles.</p>
<p>In R, the decile for each observation can be added to the dataset with the function ntile():</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ca2015 <span class="ot">&lt;-</span> ca2015 <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">decile =</span> <span class="fu">ntile</span>(inc, <span class="dv">10</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the last column of ca2015 is the decile for each observation in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ca2015 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decile) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(votendp) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(votendp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">cumsumlag =</span> (<span class="fu">lag</span>(<span class="fu">cumsum</span>(prop))),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">cumsum =</span> <span class="fu">cumsum</span>(prop)) <span class="ot">-&gt;</span> table.income.vote</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>table.income.vote <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">caption =</span> <span class="st">"Decile and income bracket"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="qxdwzszvbf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qxdwzszvbf .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#qxdwzszvbf .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qxdwzszvbf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qxdwzszvbf .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#qxdwzszvbf .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#qxdwzszvbf .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qxdwzszvbf .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qxdwzszvbf .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qxdwzszvbf .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qxdwzszvbf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qxdwzszvbf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qxdwzszvbf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qxdwzszvbf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qxdwzszvbf .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qxdwzszvbf .gt_from_md > :first-child {
  margin-top: 0;
}

#qxdwzszvbf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qxdwzszvbf .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qxdwzszvbf .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qxdwzszvbf .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qxdwzszvbf .gt_row_group_first td {
  border-top-width: 2px;
}

#qxdwzszvbf .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qxdwzszvbf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qxdwzszvbf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qxdwzszvbf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qxdwzszvbf .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qxdwzszvbf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qxdwzszvbf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qxdwzszvbf .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#qxdwzszvbf .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qxdwzszvbf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qxdwzszvbf .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qxdwzszvbf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qxdwzszvbf .gt_left {
  text-align: left;
}

#qxdwzszvbf .gt_center {
  text-align: center;
}

#qxdwzszvbf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qxdwzszvbf .gt_font_normal {
  font-weight: normal;
}

#qxdwzszvbf .gt_font_bold {
  font-weight: bold;
}

#qxdwzszvbf .gt_font_italic {
  font-style: italic;
}

#qxdwzszvbf .gt_super {
  font-size: 65%;
}

#qxdwzszvbf .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qxdwzszvbf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qxdwzszvbf .gt_indent_1 {
  text-indent: 5px;
}

#qxdwzszvbf .gt_indent_2 {
  text-indent: 10px;
}

#qxdwzszvbf .gt_indent_3 {
  text-indent: 15px;
}

#qxdwzszvbf .gt_indent_4 {
  text-indent: 20px;
}

#qxdwzszvbf .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Decile and income bracket</caption>
<thead class="gt_col_headings">
<tr class="header">
<th id="decile" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">decile</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
<th id="cumsumlag" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumsumlag</th>
<th id="cumsum" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumsum</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">76</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.10368349</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">NA</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1036835</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">70</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09549795</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1036835</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1991814</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">106</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14461119</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1991814</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3437926</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">81</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.11050477</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3437926</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.4542974</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">57</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07776262</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.4542974</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.5320600</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">88</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.12005457</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.5320600</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6521146</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">70</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09549795</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6521146</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7476126</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">67</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09140518</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7476126</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8390177</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">9</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">63</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.08594816</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8390177</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">0.9249659</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="decile" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">55</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07503411</td>
<td class="gt_row gt_right" headers="cumsumlag" style="font-family: 'Source Sans Pro'; font-weight: 400">0.9249659</td>
<td class="gt_row gt_right" headers="cumsum" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>However, it is straightforward to see that the ntile() function has flaws in decile computing.</p>
<p>More generally, computing income decile when the income variable is in brackets seems complicated, but the technical note proposes a re-weighting average approach to partially solve this problem.</p>
<p>To see how the re-weighing approach works, let’s go back to the first table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="vjchorkwhg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vjchorkwhg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#vjchorkwhg .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vjchorkwhg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vjchorkwhg .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#vjchorkwhg .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#vjchorkwhg .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vjchorkwhg .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vjchorkwhg .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vjchorkwhg .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vjchorkwhg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vjchorkwhg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vjchorkwhg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vjchorkwhg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vjchorkwhg .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vjchorkwhg .gt_from_md > :first-child {
  margin-top: 0;
}

#vjchorkwhg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vjchorkwhg .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vjchorkwhg .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vjchorkwhg .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vjchorkwhg .gt_row_group_first td {
  border-top-width: 2px;
}

#vjchorkwhg .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vjchorkwhg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vjchorkwhg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vjchorkwhg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vjchorkwhg .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vjchorkwhg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vjchorkwhg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vjchorkwhg .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#vjchorkwhg .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vjchorkwhg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vjchorkwhg .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vjchorkwhg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vjchorkwhg .gt_left {
  text-align: left;
}

#vjchorkwhg .gt_center {
  text-align: center;
}

#vjchorkwhg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vjchorkwhg .gt_font_normal {
  font-weight: normal;
}

#vjchorkwhg .gt_font_bold {
  font-weight: bold;
}

#vjchorkwhg .gt_font_italic {
  font-style: italic;
}

#vjchorkwhg .gt_super {
  font-size: 65%;
}

#vjchorkwhg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vjchorkwhg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vjchorkwhg .gt_indent_1 {
  text-indent: 5px;
}

#vjchorkwhg .gt_indent_2 {
  text-indent: 10px;
}

#vjchorkwhg .gt_indent_3 {
  text-indent: 15px;
}

#vjchorkwhg .gt_indent_4 {
  text-indent: 20px;
}

#vjchorkwhg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="inc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">inc</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="prop_vote" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop_vote</th>
<th id="cum.n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cum.n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
<th id="rangeleft" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">rangeleft</th>
<th id="cumrelfreqN" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqN</th>
<th id="cumrelfreqInc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqInc</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3173653</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.004975124</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2580645</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">109</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.014925373</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2343750</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">124</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02046385</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.029850746</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2134146</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">159</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.049751244</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3291925</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">212</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.074626866</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">47</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2955975</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">259</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06412005</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.104477612</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">44</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2784810</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">303</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06002729</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.139303483</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">71</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2253968</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">374</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09686221</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.179104478</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">34</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1954023</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">408</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04638472</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.228855721</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2348993</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">443</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.283582090</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">50</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2450980</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">493</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06821282</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.343283582</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">28</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2105263</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">521</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03819918</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.407960199</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2121212</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">577</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.477611940</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1666667</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">596</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02592087</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.552238806</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">26</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1870504</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">622</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03547067</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.631840796</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1699029</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">657</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.716417910</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">23</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2169811</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">680</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03137790</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.805970149</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">32</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1828571</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">712</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04365621</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.900497512</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">21</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1265060</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">733</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02864939</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">1.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">1.000000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can directly see the problem posed by income brackets: for example, we can see that all of income bracket one belongs to the first decile since its relative range is between 0 and 0.0723. However, the relative range of bracket two is [0.0723 - 0.1487]. Some part of it belong to the first decile ([0 - 0.1]), but some belong to the second ([0 - 0.2]). The approach to compute the proportion of observations belonging to the any given decile is to compute the share of each income bracket belonging to this decile and then compute a weighted average. For example, if I want to compute the share of observation of the first decile (D10), I already know that 100% of income bracket one belongs to D10 but I need to know the share of bracket 2 (B2) belonging to D10.</p>
<p>To estimate this, let’s assume the distribution of B2 is uniform <span class="math inline">\(x \sim U[0.0723; 0.1487]\)</span>, with x the observation within this range. We want to know <span class="math inline">\(P(x&lt;0.1)\)</span>, that is to say, the probability that x belongs to the first decile. We use the uniform cumulative distribution function with parameters min = 0.073 and max = 0.1487: <span class="math inline">\(P(x&lt;0.1) = \frac{0.1-0.0723}{0.1487-0.0723} = 0.3626\)</span>. This means that 36.26% of B2 belongs to D10. Then, the weighted average for the proportion of observation within D10: <span class="math inline">\(\frac{1*0.317+0.3626*0.26}{1+0.3626} = 0.3018\)</span>. 30.2% the first decile voters voted for the NDP in 2015.</p>
<p>Here are the computations in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">punif</span>(<span class="fl">0.1</span>, table.income<span class="sc">$</span>cumrelfreqN[<span class="dv">1</span>], table.income<span class="sc">$</span>cumrelfreqN[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3625</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">*</span><span class="fl">0.317+0.3626</span><span class="sc">*</span><span class="fl">0.26</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+0.3626</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3018318</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[<span class="dv">1</span>], table.income<span class="sc">$</span>prop_vote[<span class="dv">2</span>]), <span class="at">w =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">punif</span>(<span class="fl">0.1</span>, table.income<span class="sc">$</span>cumrelfreqN[<span class="dv">1</span>], table.income<span class="sc">$</span>cumrelfreqN[<span class="dv">2</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.301588</code></pre>
</div>
</div>
<p>Unfortunately, there is to my knowledge no function in R that will compute the weights automatically. I can nonetheless compute them through a tedious for loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(table.income<span class="sc">$</span>inc))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(table.income<span class="sc">$</span>inc)) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  weight[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="fu">punif</span>(<span class="fl">0.1</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.3</span>, <span class="fu">punif</span>(<span class="fl">0.2</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.4</span>, <span class="fu">punif</span>(<span class="fl">0.3</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.4</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="fu">punif</span>(<span class="fl">0.4</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]), </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.6</span>, <span class="fu">punif</span>(<span class="fl">0.5</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]), </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.6</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.7</span>, <span class="fu">punif</span>(<span class="fl">0.6</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                                                            <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="fu">punif</span>(<span class="fl">0.7</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="fl">0.9</span>, <span class="fu">punif</span>(<span class="fl">0.8</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]), </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">ifelse</span>(table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>cumrelfreqN[i] <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="fu">punif</span>(<span class="fl">0.9</span>, <span class="at">min =</span> table.income<span class="sc">$</span>cumrelfreqN[i<span class="dv">-1</span>], <span class="at">max =</span> table.income<span class="sc">$</span>cumrelfreqN[i]), <span class="dv">1</span>))))))))))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>weight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.0000000 0.3625000 0.0000000 0.6457143 0.0000000 0.1680851 0.7772727
 [8] 0.8943662 0.0000000 0.9085714 0.0000000 0.7178571 0.0000000 0.4947368
[15] 0.0000000 0.0000000 0.1173913 0.0000000 1.0000000</code></pre>
</div>
</div>
<p>I replace the 0 with 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weight <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, weight)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>table.income <span class="ot">&lt;-</span> table.income <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_decile =</span> weight)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_rest =</span> <span class="dv">1</span> <span class="sc">-</span> weight) <span class="ot">-&gt;</span> table.income</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prop_vote =</span> table.income.pervote<span class="sc">$</span>prop[table.income.pervote<span class="sc">$</span>votendp <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="dppjczzkbs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dppjczzkbs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#dppjczzkbs .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dppjczzkbs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dppjczzkbs .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#dppjczzkbs .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#dppjczzkbs .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dppjczzkbs .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dppjczzkbs .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dppjczzkbs .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dppjczzkbs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dppjczzkbs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dppjczzkbs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dppjczzkbs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dppjczzkbs .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dppjczzkbs .gt_from_md > :first-child {
  margin-top: 0;
}

#dppjczzkbs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dppjczzkbs .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dppjczzkbs .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dppjczzkbs .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dppjczzkbs .gt_row_group_first td {
  border-top-width: 2px;
}

#dppjczzkbs .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dppjczzkbs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dppjczzkbs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dppjczzkbs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dppjczzkbs .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dppjczzkbs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dppjczzkbs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dppjczzkbs .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#dppjczzkbs .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dppjczzkbs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dppjczzkbs .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dppjczzkbs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dppjczzkbs .gt_left {
  text-align: left;
}

#dppjczzkbs .gt_center {
  text-align: center;
}

#dppjczzkbs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dppjczzkbs .gt_font_normal {
  font-weight: normal;
}

#dppjczzkbs .gt_font_bold {
  font-weight: bold;
}

#dppjczzkbs .gt_font_italic {
  font-style: italic;
}

#dppjczzkbs .gt_super {
  font-size: 65%;
}

#dppjczzkbs .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#dppjczzkbs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dppjczzkbs .gt_indent_1 {
  text-indent: 5px;
}

#dppjczzkbs .gt_indent_2 {
  text-indent: 10px;
}

#dppjczzkbs .gt_indent_3 {
  text-indent: 15px;
}

#dppjczzkbs .gt_indent_4 {
  text-indent: 20px;
}

#dppjczzkbs .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="inc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">inc</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="prop_vote" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop_vote</th>
<th id="cum.n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cum.n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
<th id="rangeleft" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">rangeleft</th>
<th id="cumrelfreqN" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqN</th>
<th id="cumrelfreqInc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqInc</th>
<th id="share_decile" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">share_decile</th>
<th id="share_rest" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">share_rest</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3173653</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.004975124</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2580645</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">109</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.014925373</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3625000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.63750000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2343750</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">124</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02046385</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.029850746</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2134146</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">159</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.049751244</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6457143</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35428571</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3291925</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">212</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.074626866</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">47</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2955975</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">259</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06412005</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.104477612</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1680851</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.83191489</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">44</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2784810</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">303</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06002729</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.139303483</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7772727</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.22272727</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">71</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2253968</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">374</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09686221</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.179104478</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8943662</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.10563380</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">34</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1954023</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">408</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04638472</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.228855721</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2348993</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">443</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.283582090</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.9085714</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09142857</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">50</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2450980</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">493</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06821282</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.343283582</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">28</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2105263</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">521</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03819918</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.407960199</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7178571</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28214286</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2121212</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">577</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.477611940</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1666667</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">596</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02592087</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.552238806</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.4947368</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.50526316</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">26</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1870504</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">622</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03547067</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.631840796</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1699029</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">657</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.716417910</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">23</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2169811</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">680</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03137790</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.805970149</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1173913</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.88260870</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">32</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1828571</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">712</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04365621</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.900497512</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">21</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1265060</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">733</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02864939</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">1.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">1.000000000</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There can be mistakes, but the results seem to make sense</p>
<p>Since I do not want to ever do this computation again (😅), I put all of this into a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>weight_share <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>   weight[i] <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>(x[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> x[i] <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="fu">punif</span>(<span class="fl">0.1</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.3</span>, <span class="fu">punif</span>(<span class="fl">0.2</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.4</span>, <span class="fu">punif</span>(<span class="fl">0.3</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.4</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="fu">punif</span>(<span class="fl">0.4</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.6</span>, <span class="fu">punif</span>(<span class="fl">0.5</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.6</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.7</span>, <span class="fu">punif</span>(<span class="fl">0.6</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                                                            <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="fu">punif</span>(<span class="fl">0.7</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.9</span>, <span class="fu">punif</span>(<span class="fl">0.8</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                                                                                                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="fu">punif</span>(<span class="fl">0.9</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), <span class="dv">1</span>))))))))))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weight <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, weight)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(weight)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check if the function works</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weight_share</span>(<span class="at">x =</span> table.income<span class="sc">$</span>cumrelfreqN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.0000000 0.3625000 1.0000000 0.6457143 1.0000000 0.1680851 0.7772727
 [8] 0.8943662 1.0000000 0.9085714 1.0000000 0.7178571 1.0000000 0.4947368
[15] 1.0000000 1.0000000 0.1173913 1.0000000 1.0000000</code></pre>
</div>
</div>
<p>We are almost done, there are only the weighted averages for each decile left to compute. One further step is to compute dummy variables to show to which decile income brackets belong to. This will produce a table close to the one from the technical note.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d1 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> table.income<span class="sc">$</span>rangeleft <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">d2 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dv">1</span>, <span class="dv">0</span>),  <span class="co"># the %[]% is an "between" operator from the Desctools package. for example, x %[]% c(a, b) checks whether x belong to the interval [a, b] with a&lt;b </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d5 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d6 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">ifelse</span>(table.income<span class="sc">$</span>rangeleft <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>) <span class="sc">|</span> table.income<span class="sc">$</span>cumrelfreqN <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="ot">-&gt;</span> table.income</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>table.income <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="bxakpibikv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bxakpibikv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #FFFFFF;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #333333;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #333333;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #333333;
}

#bxakpibikv .gt_heading {
  background-color: #333333;
  text-align: left;
  border-bottom-color: #333333;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bxakpibikv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bxakpibikv .gt_title {
  color: #FFFFFF;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #333333;
  border-bottom-width: 0;
}

#bxakpibikv .gt_subtitle {
  color: #FFFFFF;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #333333;
  border-top-width: 0;
}

#bxakpibikv .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bxakpibikv .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bxakpibikv .gt_col_heading {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bxakpibikv .gt_column_spanner_outer {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bxakpibikv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bxakpibikv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bxakpibikv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #FFFFFF;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bxakpibikv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bxakpibikv .gt_empty_group_heading {
  padding: 0.5px;
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bxakpibikv .gt_from_md > :first-child {
  margin-top: 0;
}

#bxakpibikv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bxakpibikv .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bxakpibikv .gt_stub {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bxakpibikv .gt_stub_row_group {
  color: #FFFFFF;
  background-color: #333333;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bxakpibikv .gt_row_group_first td {
  border-top-width: 2px;
}

#bxakpibikv .gt_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bxakpibikv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bxakpibikv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bxakpibikv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bxakpibikv .gt_grand_summary_row {
  color: #FFFFFF;
  background-color: #333333;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bxakpibikv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bxakpibikv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bxakpibikv .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #333333;
}

#bxakpibikv .gt_footnotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bxakpibikv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bxakpibikv .gt_sourcenotes {
  color: #FFFFFF;
  background-color: #333333;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bxakpibikv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bxakpibikv .gt_left {
  text-align: left;
}

#bxakpibikv .gt_center {
  text-align: center;
}

#bxakpibikv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bxakpibikv .gt_font_normal {
  font-weight: normal;
}

#bxakpibikv .gt_font_bold {
  font-weight: bold;
}

#bxakpibikv .gt_font_italic {
  font-style: italic;
}

#bxakpibikv .gt_super {
  font-size: 65%;
}

#bxakpibikv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#bxakpibikv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bxakpibikv .gt_indent_1 {
  text-indent: 5px;
}

#bxakpibikv .gt_indent_2 {
  text-indent: 10px;
}

#bxakpibikv .gt_indent_3 {
  text-indent: 15px;
}

#bxakpibikv .gt_indent_4 {
  text-indent: 20px;
}

#bxakpibikv .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="inc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">inc</th>
<th id="votendp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">votendp</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">n</th>
<th id="prop_vote" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop_vote</th>
<th id="cum.n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cum.n</th>
<th id="prop" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">prop</th>
<th id="rangeleft" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">rangeleft</th>
<th id="cumrelfreqN" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqN</th>
<th id="cumrelfreqInc" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">cumrelfreqInc</th>
<th id="share_decile" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">share_decile</th>
<th id="share_rest" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">share_rest</th>
<th id="d1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d1</th>
<th id="d2" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d2</th>
<th id="d3" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d3</th>
<th id="d4" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d4</th>
<th id="d5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d5</th>
<th id="d6" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d6</th>
<th id="d7" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d7</th>
<th id="d8" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d8</th>
<th id="d9" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d9</th>
<th id="d10" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-family: 'Source Sans Pro'; text-transform: uppercase" scope="col">d10</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3173653</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.004975124</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">2</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2580645</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">109</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.014925373</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3625000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.63750000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">3</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2343750</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">124</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02046385</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.14870396</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.029850746</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">4</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2134146</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">159</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.16916780</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.049751244</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.6457143</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35428571</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">5</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">53</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.3291925</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">212</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07230559</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.21691678</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.074626866</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">6</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">47</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2955975</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">259</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06412005</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28922237</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.104477612</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1680851</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.83191489</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">7</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">44</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2784810</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">303</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06002729</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.35334243</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.139303483</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7772727</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.22272727</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">8</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">71</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2253968</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">374</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09686221</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.41336971</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.179104478</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.8943662</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.10563380</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">10</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">34</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1954023</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">408</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04638472</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.51023192</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.228855721</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">11</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2348993</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">443</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.55661664</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.283582090</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.9085714</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.09142857</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">12</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">50</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2450980</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">493</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.06821282</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.60436562</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.343283582</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">13</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">28</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2105263</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">521</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03819918</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.67257844</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.407960199</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.7178571</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.28214286</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">14</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">56</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2121212</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">577</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.07639836</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.71077763</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.477611940</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">15</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1666667</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">596</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02592087</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.78717599</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.552238806</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.4947368</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.50526316</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">16</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">26</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1870504</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">622</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03547067</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.81309686</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.631840796</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">17</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">35</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1699029</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">657</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04774898</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.84856753</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.716417910</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">18</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">23</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.2169811</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">680</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.03137790</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.89631651</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.805970149</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1173913</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.88260870</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">19</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">32</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1828571</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">712</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.04365621</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.92769441</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">0.900497512</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="inc" style="font-family: 'Source Sans Pro'; font-weight: 400">20</td>
<td class="gt_row gt_right" headers="votendp" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
<td class="gt_row gt_right" headers="n" style="font-family: 'Source Sans Pro'; font-weight: 400">21</td>
<td class="gt_row gt_right" headers="prop_vote" style="font-family: 'Source Sans Pro'; font-weight: 400">0.1265060</td>
<td class="gt_row gt_right" headers="cum.n" style="font-family: 'Source Sans Pro'; font-weight: 400">733</td>
<td class="gt_row gt_right" headers="prop" style="font-family: 'Source Sans Pro'; font-weight: 400">0.02864939</td>
<td class="gt_row gt_right" headers="rangeleft" style="font-family: 'Source Sans Pro'; font-weight: 400">0.97135061</td>
<td class="gt_row gt_right" headers="cumrelfreqN" style="font-family: 'Source Sans Pro'; font-weight: 400">1.00000000</td>
<td class="gt_row gt_right" headers="cumrelfreqInc" style="font-family: 'Source Sans Pro'; font-weight: 400">1.000000000</td>
<td class="gt_row gt_right" headers="share_decile" style="font-family: 'Source Sans Pro'; font-weight: 400">1.0000000</td>
<td class="gt_row gt_right" headers="share_rest" style="font-family: 'Source Sans Pro'; font-weight: 400">0.00000000</td>
<td class="gt_row gt_right" headers="d1" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d2" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d3" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d4" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d5" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d6" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d7" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d8" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d9" style="font-family: 'Source Sans Pro'; font-weight: 400">0</td>
<td class="gt_row gt_right" headers="d10" style="font-family: 'Source Sans Pro'; font-weight: 400">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Tu put the code above into a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>decile_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(data, rangeleft, rangeright){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d1 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> {{rangeleft}} <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d2 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dv">1</span>, <span class="dv">0</span>),  <span class="co">#%[]% is an within bracket operator from the Desctools package. for example, x %[]% c(a, b) checks whether x belong to the interval [a, b] with a&lt;b </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d5 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">d6 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This compute the proportion of the first decile directly from the table above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="at">x =</span> table.income<span class="sc">$</span>prop_vote[table.income<span class="sc">$</span>d1 <span class="sc">==</span> <span class="dv">1</span>], <span class="at">w =</span> table.income<span class="sc">$</span>share_decile[table.income<span class="sc">$</span>d1 <span class="sc">==</span> <span class="dv">1</span>]) <span class="co"># d1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.301588</code></pre>
</div>
</div>
<p>Let’s try to compute the 3 first decile in a way that can then be put into a for loop or even into a function later</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for d_i</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[table.income[,<span class="dv">12</span>] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>share_decile[table.income[,<span class="dv">12</span>] <span class="sc">==</span> <span class="dv">1</span>])) <span class="co">#d1: take columns 11 (D1) and the values of prop vote and share decile for which D11 == 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.301588</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[table.income[,<span class="dv">13</span>] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>share_rest[table.income[,<span class="dv">12</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> table.income[, <span class="dv">13</span>] <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                    table.income<span class="sc">$</span>share_decile[table.income[,<span class="dv">12</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> table.income[,<span class="dv">13</span>] <span class="sc">==</span> <span class="dv">1</span>])) <span class="co">#d2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2350616</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[table.income[,<span class="dv">14</span>] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>share_rest[table.income[,<span class="dv">14-1</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> table.income[, <span class="dv">14</span>] <span class="sc">==</span> <span class="dv">1</span>], <span class="co">#d3</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                    table.income<span class="sc">$</span>share_decile[table.income[<span class="dv">14-1</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> table.income[,<span class="dv">14</span>] <span class="sc">==</span> <span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2985395</code></pre>
</div>
</div>
<p>Let’s try the for loop</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#11:20 are the decile dummies columns in the dataset</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">21</span>) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">12</span>){</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  decile <span class="ot">=</span>  <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[table.income[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>share_decile[table.income[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>   decile <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>prop_vote[table.income[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(table.income<span class="sc">$</span>share_rest[table.income[,i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> table.income[, i] <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                    table.income<span class="sc">$</span>share_decile[table.income[i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> table.income[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(decile,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(decile_vec)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">decile =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop =</span> decile_vec)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>decile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   decile      prop
1       1 0.3015880
2       2 0.2350616
3       3 0.2985395
4       4 0.2873299
5       5 0.2359808
6       6 0.2147917
7       7 0.2308659
8       8 0.1992121
9       9 0.1779249
10     10 0.1737567</code></pre>
</div>
</div>
<p>This seems to work, the 3 first values are the same as the ones computed above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>decile <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(decile), <span class="at">y =</span> prop)<span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="technical-note-piketty-2021_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This graph is very close to the one from the techninal note (figure one, right-sided graph)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="graph1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>For now, let’s put the for loop into a function: this function would require the decile dummies columns, the columns for the proportion, the column for decile share and the column for the rest’s share:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, columns, prop, share_decile, share_rest){</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  decile_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">min</span>(columns)<span class="sc">:</span><span class="fu">max</span>(columns)) {</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="fu">min</span>(columns)){</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  decile <span class="ot">=</span>  <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_decile[data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>   decile <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_rest[data[,i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> data[, i] <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                    share_decile[data[i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(decile,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(decile_vec)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">decile =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop =</span> decile_vec)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> decile <span class="sc">%&gt;%</span> </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace</span>(.x, <span class="fu">is.nan</span>(.x), <span class="dv">0</span>))) <span class="co"># if an income group has no individuals who has votendp == 1, make the function return 0 instead of NaNs</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decile</span>(<span class="at">data =</span> table.income, <span class="at">columns =</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">21</span>, <span class="at">prop =</span> table.income<span class="sc">$</span>prop_vote, <span class="at">share_decile =</span> table.income<span class="sc">$</span>share_decile, <span class="at">share_rest =</span> table.income<span class="sc">$</span>share_rest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function seems to work, but requires a specific dataframe (formatted as table.income).</p>
</section>
</section>
<section id="summing-up-all-of-this-into-one-function" class="level2">
<h2 class="anchored" data-anchor-id="summing-up-all-of-this-into-one-function">Summing up all of this into one function</h2>
<p>The goal here is to write all the steps above into one function, such that only the variable from the dataset must be given to compute the deciles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note: the function needs the weight_share() function and the decile_dummies function and the decile function</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>weight_share <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>   weight[i] <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>(x[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> x[i] <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="fu">punif</span>(<span class="fl">0.1</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.3</span>, <span class="fu">punif</span>(<span class="fl">0.2</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.4</span>, <span class="fu">punif</span>(<span class="fl">0.3</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.4</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="fu">punif</span>(<span class="fl">0.4</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.6</span>, <span class="fu">punif</span>(<span class="fl">0.5</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.6</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.7</span>, <span class="fu">punif</span>(<span class="fl">0.6</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                                                            <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="fu">punif</span>(<span class="fl">0.7</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.9</span>, <span class="fu">punif</span>(<span class="fl">0.8</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                                                                                                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="fu">punif</span>(<span class="fl">0.9</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), <span class="dv">1</span>))))))))))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weight <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, weight)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>decile_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(data, rangeleft, rangeright){</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d1 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> {{rangeleft}} <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">d2 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dv">1</span>, <span class="dv">0</span>),  <span class="co">#%[]% is an within bracket operator from the Desctools package. for example, x %[]% c(a, b) checks whether x belong to the interval [a, b] with a&lt;b </span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">d5 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">d6 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, columns, prop, share_decile, share_rest){</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  decile_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">min</span>(columns)<span class="sc">:</span><span class="fu">max</span>(columns)) {</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="fu">min</span>(columns)){</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  decile <span class="ot">=</span>  <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_decile[data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>   decile <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_rest[data[,i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> data[, i] <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>                    share_decile[data[i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(decile,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(decile_vec)</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">decile =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop =</span> decile_vec)</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> decile <span class="sc">%&gt;%</span> </span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace</span>(.x, <span class="fu">is.nan</span>(.x), <span class="dv">0</span>))) <span class="do">### if a group has no observation in the count, replace the NaNs by zeros</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>decile</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>decile_final <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, by, value){</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> </span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>  {{data}} <span class="sc">%&gt;%</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>({{by}}) <span class="sc">%&gt;%</span> </span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>({{x}}) <span class="sc">%&gt;%</span> </span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_x =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_x =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>({{x}} <span class="sc">==</span> value)</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> </span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>{{data}} <span class="sc">%&gt;%</span> </span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>({{x}} <span class="sc">==</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>({{by}}) <span class="sc">%&gt;%</span> </span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>({{x}}) <span class="sc">%&gt;%</span> </span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_x =</span> table1<span class="sc">$</span>prop_x,</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">rangeleft =</span> <span class="fu">lag</span>(<span class="fu">cumsum</span>(prop), <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">cumrelfreq =</span> <span class="fu">cumsum</span>(prop),</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>         <span class="at">share_decile =</span> <span class="fu">weight_share</span>(cumrelfreq),</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">share_rest =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">weight_share</span>(cumrelfreq)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">decile_dummies</span>(<span class="at">rangeleft =</span> rangeleft, <span class="at">rangeright =</span> cumrelfreq)</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>decile_columns <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(table)<span class="sc">==</span><span class="st">"d1"</span> )<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(table)<span class="sc">==</span><span class="st">"d10"</span> )</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a><span class="fu">decile</span>(<span class="at">data =</span> table, <span class="at">columns =</span> decile_columns, <span class="at">prop =</span> table<span class="sc">$</span>prop_x, <span class="at">share_decile =</span> table<span class="sc">$</span>share_decile, <span class="at">share_rest =</span> table<span class="sc">$</span>share_rest)</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decile_final</span>(<span class="at">data =</span> ca2015, <span class="at">by =</span> inc, <span class="at">x =</span> votendp, <span class="at">value =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   decile      prop
1       1 0.3015880
2       2 0.2350616
3       3 0.2985395
4       4 0.2873299
5       5 0.2359808
6       6 0.2147917
7       7 0.2308659
8       8 0.1992121
9       9 0.1779249
10     10 0.1737567</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decile_final</span>(<span class="at">data =</span> ca2015, <span class="at">by =</span> inc, <span class="at">x =</span> votelib, <span class="at">value =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   decile      prop
1       1 0.3807777
2       2 0.4229278
3       3 0.3830486
4       4 0.3831860
5       5 0.4397704
6       6 0.3894084
7       7 0.4532439
8       8 0.4113987
9       9 0.4132309
10     10 0.4833679</code></pre>
</div>
</div>
<section id="whats-next" class="level3">
<h3 class="anchored" data-anchor-id="whats-next">What’s Next?</h3>
<p>Even if the goal of reproducing the WPID’s methodology is now done, I am still unsatisfied with some aspects of the work done above. I will try in the future to do the following:</p>
<ul>
<li><p>Improve the code of all the functions (see below)</p></li>
<li><p>Improve the functions to allow for greater flexibility (for example allowing to compute not only decile, but also quartiles, quintiles…)</p></li>
<li><p>Create a function which assigns each individual of the dataset to a quantile group (Piketty and Co-authors provide the function only in Stata…)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note: the function needs the weight_share() function and the decile_dummies function and the decile function</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I am Still working on improving these functions: simplify the code and allow for a lot more flexibility, for instance:</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 1. compute different quantile groups (quartile, quintiles... instead of always deciles)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>weight_share <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>   weight[i] <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>(x[i] <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">|</span> x[i] <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="fu">punif</span>(<span class="fl">0.1</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.3</span>, <span class="fu">punif</span>(<span class="fl">0.2</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.4</span>, <span class="fu">punif</span>(<span class="fl">0.3</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.4</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="fu">punif</span>(<span class="fl">0.4</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.6</span>, <span class="fu">punif</span>(<span class="fl">0.5</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.6</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.7</span>, <span class="fu">punif</span>(<span class="fl">0.6</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                                                            <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="fu">punif</span>(<span class="fl">0.7</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="fl">0.9</span>, <span class="fu">punif</span>(<span class="fl">0.8</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                                                                                                         <span class="fu">ifelse</span>(x[i] <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">&amp;</span> x[i] <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="fu">punif</span>(<span class="fl">0.9</span>, <span class="at">min =</span> x[i<span class="dv">-1</span>], <span class="at">max =</span> x[i]), <span class="dv">1</span>))))))))))</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weight <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, weight)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>decile_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(data, rangeleft, rangeright){</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d1 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> {{rangeleft}} <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">d2 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dv">1</span>, <span class="dv">0</span>),  <span class="co">#%[]% is an within bracket operator from the Desctools package. for example, x %[]% c(a, b) checks whether x belong to the interval [a, b] with a&lt;b </span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">d5 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">d6 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">d7 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">d8 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">d9 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">d10 =</span> <span class="fu">ifelse</span>({{rangeleft}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>) <span class="sc">|</span> {{rangeright}} <span class="sc">%[]%</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, columns, prop, share_decile, share_rest){</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>  decile_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">min</span>(columns)<span class="sc">:</span><span class="fu">max</span>(columns)) {</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="fu">min</span>(columns)){</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>  decile <span class="ot">=</span>  <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_decile[data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>   decile <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">weighted.mean</span>(<span class="at">x =</span> <span class="fu">c</span>(prop[data[,i] <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">w =</span> <span class="fu">c</span>(share_rest[data[,i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> data[, i] <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                    share_decile[data[i<span class="dv">-1</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> data[,i] <span class="sc">==</span> <span class="dv">1</span>])))</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(decile,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>decile_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(decile_vec)</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">decile =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop =</span> decile_vec)</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>decile</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>table_decile <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, by, value){</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> </span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>  {{data}} <span class="sc">%&gt;%</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>({{by}}) <span class="sc">%&gt;%</span> </span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>({{x}}) <span class="sc">%&gt;%</span> </span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_x =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_x =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>({{x}} <span class="sc">==</span> value)</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> </span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>{{data}} <span class="sc">%&gt;%</span> </span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>({{x}} <span class="sc">==</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>({{by}}) <span class="sc">%&gt;%</span> </span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>({{x}}) <span class="sc">%&gt;%</span> </span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_x =</span> table1<span class="sc">$</span>prop_x,</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">rangeleft =</span> <span class="fu">lag</span>(<span class="fu">cumsum</span>(prop), <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">cumrelfreq =</span> <span class="fu">cumsum</span>(prop),</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">share_decile =</span> <span class="fu">weight_share</span>(cumrelfreq),</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">share_rest =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">weight_share</span>(cumrelfreq)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">decile_dummies</span>(<span class="at">rangeleft =</span> rangeleft, <span class="at">rangeright =</span> cumrelfreq)</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>decile_columns <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(table)<span class="sc">==</span><span class="st">"d1"</span> )<span class="sc">:</span><span class="fu">which</span>(<span class="fu">colnames</span>(table)<span class="sc">==</span><span class="st">"d10"</span>)</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">table =</span> table,</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>     <span class="at">decile =</span> <span class="fu">decile</span>(<span class="at">data =</span> table, <span class="at">columns =</span> decile_columns, <span class="at">prop =</span> table<span class="sc">$</span>prop_x, <span class="at">share_decile =</span> table<span class="sc">$</span>share_decile, <span class="at">share_rest =</span> table<span class="sc">$</span>share_rest))</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>